<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">

<!--<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-flash.css" rel="stylesheet">-->






<script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>



















  
  
    
  
  <link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.4.1/dist/jquery.fancybox.min.css" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Damion:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: 'DPEJKVP344',
      apiKey: '6c27f1978e56310240b66f082843db73',
      indexName: 'blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="强烈建议star、fork该项目，该项目可以作为学习改造Spring Cloud组件的案例项目。   Nepxion Discovery是一款对Spring Cloud的服务注册发现的增强中间件，其功能包括多版本灰度发布，黑/白名单的IP地址过滤，限制注册等，支持Eureka、Consul和Zookeeper。现有的Spring Cloud微服务可以方便引入该插件，代码零侵入，使用者只需要">
<meta name="keywords" content="java,SpringCloud">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Cloud微服务版本灰度发布新神器">
<meta property="og:url" content="http://codewey.com/post/spring-cloud-version-god-tool/index.html">
<meta property="og:site_name" content="Codewey">
<meta property="og:description" content="强烈建议star、fork该项目，该项目可以作为学习改造Spring Cloud组件的案例项目。   Nepxion Discovery是一款对Spring Cloud的服务注册发现的增强中间件，其功能包括多版本灰度发布，黑/白名单的IP地址过滤，限制注册等，支持Eureka、Consul和Zookeeper。现有的Spring Cloud微服务可以方便引入该插件，代码零侵入，使用者只需要">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c2733c95e8887?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c2733cb52283a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c2733c892375f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c2733c962de18?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c2733eb71dd1b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c2733f4a84432?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c27341aa44d0e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c273461578b55?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c27347067221a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c2734732d985b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c27347658b7e1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c27347a81d43d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c27347a81d43d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c2734898bf386?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c273494b31e95?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:updated_time" content="2019-04-07T10:13:31.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring Cloud微服务版本灰度发布新神器">
<meta name="twitter:description" content="强烈建议star、fork该项目，该项目可以作为学习改造Spring Cloud组件的案例项目。   Nepxion Discovery是一款对Spring Cloud的服务注册发现的增强中间件，其功能包括多版本灰度发布，黑/白名单的IP地址过滤，限制注册等，支持Eureka、Consul和Zookeeper。现有的Spring Cloud微服务可以方便引入该插件，代码零侵入，使用者只需要">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2018/7/22/164c2733c95e8887?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">



  <link rel="alternate" href="/atom.xml" title="Codewey" type="application/atom+xml">




  <link rel="canonical" href="http://codewey.com/post/spring-cloud-version-god-tool/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <!--自定义看板娘-->
<link rel="stylesheet" type="text/css" href="/js/src/live2d/assets/waifu.min.css">
<script src="/js/src/live2d/assets/jquery.min.js"></script>
<script src="/js/src/live2d/assets/jquery-ui.min.js"></script>

  <link rel="stylesheet" href="/js/src/aplayer/APlayer.min.css">
<script src="/js/src/aplayer/APlayer.min.js"></script>
<script src="/js/src/aplayer/Meting.min.js"></script>
  <title>Spring Cloud微服务版本灰度发布新神器 | Codewey</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-89637345-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-89637345-1');
</script>









  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="en">


  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
 <!--<a href="https://github.com/XXXXXX"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png" alt="Fork me on GitHub"></a>-->
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Codewey</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-photos">

    
    
    
      
    

    

    <a href="/photos/" rel="section"><i class="menu-item-icon fa fa-fw fa-camera-retro"></i> <br>Photos</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://codewey.com/post/spring-cloud-version-god-tool/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Codewey">
      <meta itemprop="description" content="We are all living as faithful to our ideas as children.">
      <meta itemprop="image" content="/images/d6.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codewey">
    </span>
    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Spring Cloud微服务版本灰度发布新神器

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-12-20 14:54:48" itemprop="dateCreated datePublished" datetime="2018-12-20T14:54:48+08:00">2018-12-20</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/spring-cloud-version-god-tool/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count valine-comment-count" data-xid="/post/spring-cloud-version-god-tool/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/post/spring-cloud-version-god-tool/" class="leancloud_visitors" data-flag-title="Spring Cloud微服务版本灰度发布新神器">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views: </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <article data-v-a7f310c8="" itemscope="itemscope" itemtype="http://schema.org/Article" class="entry-content-box" data-v-2f10e8c4=""><meta itemprop="url" content="https://juejin.im/entry/5b54985b518825597f6b7475"><meta itemprop="headline" content="Spring Cloud微服务版本灰度发布新神器"><!----><meta itemprop="datePublished" content="2018-07-22T14:44:43.623Z"><meta itemprop="image" content="https://b-gold-cdn.xitu.io/icon/icon-128.png"><div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="方志朋"><meta itemprop="url" content="https://juejin.im/user/580382465bbb50005b76ad36"></div><div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"><div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://b-gold-cdn.xitu.io/icon/icon-white-180.png"><meta itemprop="width" content="180"><meta itemprop="height" content="180"></div><br>    强烈建议star、fork该项目，该项目可以作为学习改造Spring Cloud组件的案例项目。<br>   Nepxion Discovery是一款对Spring Cloud的服务注册发现的增强中间件，其功能包括多版本灰度发布，黑/白名单的IP地址过滤，限制注册等，支持Eureka、Consul和Zookeeper。现有的Spring Cloud微服务可以方便引入该插件，代码零侵入，使用者只需要做如下简单的事情：<br><br>    <a id="more"></a><br><br>    <ul><br>        <li><br>            引入相关Plugin Starter依赖到pom.xml<br>        </li><br>        <li><br>            必须为微服务定义一个版本号（version），在application.properties或者yaml的metadata里<br>        </li><br>        <li><br>            必须为微服务自定义一个便于为微服务归类的Key，例如组名（group）或者应用名（application），在application.properties或者yaml的metadata里，便于远程配置中心推送和灰度界面分析<br>        </li><br>        <li><br>           使用者只需要关注相关规则推送。可以采用如下方式之一<br>        </li><br>        <li><br>           通过远程配置中心推送规则<br>        </li><br>        <li><br>            通过控制台界面推送规则<br>        </li><br>        <li><br>            通过客户端工具（例如Postman）推送推测<br>        </li><br>    </ul><br>    <h2 data-id="heading-0">Quick Start</h2><br>    <ul><br>        <li><br>           图形化演示操作<br>        </li><br>        <li><br>            请访问<a href="http://www.iqiyi.com/w_19rzwzovrl.html，视频清晰度改成720P，然后最大化播放" target="_blank" rel="noopener">http://www.iqiyi.com/w_19rzwzovrl.html，视频清晰度改成720P，然后最大化播放</a><br>        </li><br>        <li><br>            请访问<a href="https://pan.baidu.com/s/1eq_N56VbgSCaTXYQ5aKqiA，获取更清晰的视频" target="_blank" rel="noopener">https://pan.baidu.com/s/1eq_N56VbgSCaTXYQ5aKqiA，获取更清晰的视频</a><br>        </li><br>        <li><br>            更多教程和示例查看最下面的“示例演示”，<br>        </li><br>    </ul><br>    <h2 data-id="heading-1">痛点</h2><br>      现有Spring Cloud的痛点<br>    <ul><br>        <li><br>            如果你是运维负责人，是否会经常发现，你掌管的测试环境中的服务注册中心，被一些不负责的开发人员把他本地开发环境注册上来，造成测试人员测试失败。你希望可以把本地开发环境注册给屏蔽掉，不让注册<br>        </li><br>        <li><br>           如果你是运维负责人，生产环境的某个微服务集群下的某个实例，暂时出了问题，但又不希望它下线。你希望可以把该实例给屏蔽掉，暂时不让它被调用<br>        </li><br>        <li><br>           如果你是业务负责人，鉴于业务服务的快速迭代性，微服务集群下的实例发布不同的版本。你希望根据版本管理策略进行路由，提供给下游微服务区别调用，达到多版本灰度访问控制<br>        </li><br>        <li><br>          如果你是测试负责人，希望对微服务做A/B测试，那么通过动态改变版本达到该目的<br>        </li><br>    </ul><br>    <h2 data-id="heading-2">简介</h2><br>    <ul><br>        <li><br>           实现对基于Spring Cloud的微服务和Zuul网关的支持<br>        </li><br>        <li><br>           具有极大灵活性 - 支持在任何环节做过滤控制和版本灰度发布<br>        </li><br>        <li><br>           具有极小限制性 - 只要开启了服务注册发现，程序入口加了@EnableDiscoveryClient<br>        </li><br>        <li><br>          实现服务注册层面的控制<br>        </li><br>        <li><br>          基于黑/白名单的IP地址过滤机制禁止对相应的微服务进行注册<br>        </li><br>        <li><br>          基于最大注册数的限制微服务注册。一旦微服务集群下注册的实例数目已经达到上限，将禁止后续的微服务进行注册<br>        </li><br>        <li><br>          实现服务发现层面的控制<br>        </li><br>        <li><br>          基于黑/白名单的IP地址过滤机制禁止对相应的微服务被发现<br>        </li><br>        <li><br>          基于版本配对，通过对消费端和提供端可访问版本对应关系的配置，在服务发现和负载均衡层面，进行多版本访问控制<br>        </li><br>        <li><br>           实现灰度发布<br>        </li><br>        <li><br>           通过规则改变，实现灰度发布<br>        </li><br>        <li><br>          通过版本切换，实现灰度发布<br>        </li><br>        <li><br>          实现通过XML进行上述规则的定义<br>        </li><br>        <li><br>          实现通过事件总线机制（EventBus）的功能，实现发布/订阅功能<br>        </li><br>        <li><br>          对接远程配置中心，默认集成阿里巴巴的Nacos，异步接受远程配置中心主动推送规则信息，动态改变微服务的规则<br>        </li><br>        <li><br>          结合Spring Boot Actuator，异步接受Rest主动推送规则信息，动态改变微服务的规则<br>        </li><br>        <li><br>          结合Spring Boot Actuator，动态改变微服务的版本<br>        </li><br>        <li><br>          在服务注册层面的控制中，一旦禁止注册的条件触发，主动推送异步事件，以便使用者订阅<br>        </li><br>        <li><br>          实现通过Listener机制进行扩展<br>        </li><br>        <li><br>          使用者可以自定义更多的规则过滤条件<br>        </li><br>        <li><br>          使用者可以对服务注册发现核心事件进行监听<br>        </li><br>        <li><br>          实现支持Spring Boot Actuator和Swagger集成<br>        </li><br>        <li><br>          实现独立控制台，支持对规则和版本集中管理，未来考虑界面实现<br>        </li><br>        <li><br>          实现支持未来扩展更多的服务注册中心<br>        </li><br>        <li><br>          实现图形化的灰度发布功能<br>        </li><br>    </ul><br>    <h2 data-id="heading-3">名词解释</h2><br>    <ul><br>        <li><br>          IP地址，即根据微服务上报的它所在机器的IP地址。本系统内部强制以IP地址上报，禁止HostName上报，杜绝Spring Cloud应用在Docker或者Kubernetes部署时候出现问题<br>        </li><br>        <li><br>          本地版本，即初始化读取本地配置文件获取的版本，也可以是第一次读取远程配置中心获取的版本。本地版本和初始版本是同一个概念<br>        </li><br>        <li><br>          动态版本，即灰度发布时的版本。动态版本和灰度版本是同一个概念<br>        </li><br>        <li><br>          本地规则，即初始化读取本地配置文件获取的规则，也可以是第一次读取远程配置中心获取的规则。本地规则和初始规则是同一个概念<br>        </li><br>        <li><br>          动态规则，即灰度发布时的规则。动态规则和灰度规则是同一个概念<br>        </li><br>        <li><br>          事件总线，即基于Google Guava的EventBus构建的组件。在使用上，通过事件总线推送动态版本和动态规则的时候，前者只支持异步，后者支持异步和同步<br>        </li><br>        <li><br>          远程配置中心，即可以存储规则配置XML格式的配置中心，可以包括不限于Apollo，DisConf，Spring Cloud Config<br>        </li><br>    </ul><br>    <h2 data-id="heading-4">场景</h2><br>    <ul><br>        <li><br>           黑/白名单的IP地址注册的过滤<br>        </li><br>        <li><br>           开发环境的本地微服务（例如IP地址为172.16.0.8）不希望被注册到测试环境的服务注册发现中心，那么可以在配置中心维护一个黑/白名单的IP地址过滤（支持全局和局部的过滤）的规则<br>        </li><br>        <li><br>           我们可以通过提供一份黑/白名单达到该效果<br>        </li><br>        <li><br>           最大注册数的限制的过滤<br>        </li><br>        <li><br>           当某个微服务注册数目已经达到上限（例如10个），那么后面起来的微服务，将再也不能注册上去<br>        </li><br>        <li><br>           黑/白名单的IP地址发现的过滤<br>        </li><br>        <li><br>           开发环境的本地微服务（例如IP地址为172.16.0.8）已经注册到测试环境的服务注册发现中心，那么可以在配置中心维护一个黑/白名单的IP地址过滤（支持全局和局部的过滤）的规则，该本地微服务不会被其他测试环境的微服务所调用<br>        </li><br>        <li><br>            我们可以通过推送一份黑/白名单达到该效果<br>        </li><br>        <li><br>           多版本灰度访问控制<br>        </li><br>        <li><br>           A服务调用B服务，而B服务有两个实例（B1、B2），虽然三者相同的服务名，但功能上有差异，需求是在某个时刻，A服务只能调用B1，禁止调用B2。在此场景下，我们在application.properties里为B1维护一个版本为1.0，为B2维护一个版本为1.1<br>        </li><br>        <li><br>           我们可以通过推送A服务调用某个版本的B服务对应关系的配置，达到某种意义上的灰度控制，切换版本的时候，我们只需要再次推送即可<br>        </li><br>        <li><br>           动态改变微服务版本<br>        </li><br>        <li><br>           在A/B测试中，通过动态改变版本，不重启微服务，达到访问版本的路径改变<br>        </li><br>    </ul><br>    <h2 data-id="heading-5">架构</h2><br>       简单描述一下，本系统的核心模块“基于版本控制的灰度发布”，从网关（Zuul）开始的灰度发布操作过程<br>    <ul><br>        <li><br>            灰度发布前<br>        </li><br>        <li><br>            假设当前生产环境，调用路径为网关(V1.0)-&gt;服务A(V1.0)-&gt;服务B(V1.0)<br>        </li><br>        <li><br>           运维将发布新的生产环境，部署新服务集群，服务A(V1.1)，服务B(V1.1)<br>        </li><br>        <li><br>           由于网关(1.0)并未指向服务A(V1.1)，服务B(V1.1)，所以它们是不能被调用的<br>        </li><br>        <li><br>            灰度发布中<br>        </li><br>        <li><br>           新增用作灰度发布的网关(V1.1)，指向服务A(V1.1)-&gt;服务B(V1.1)<br>        </li><br>        <li><br>           灰度网关(V1.1)发布到服务注册发现中心，但禁止被服务发现，网关外的调用进来无法负载均衡到网关(V1.1)上<br>        </li><br>        <li><br>            在灰度网关(V1.1)-&gt;服务A(V1.1)-&gt;服务B(V1.1)这条调用路径做灰度测试<br>        </li><br>        <li><br>            灰度测试成功后，把网关(V1.0)指向服务A(V1.1)-&gt;服务B(V1.1)<br>        </li><br>        <li><br>            灰度发布后<br>        </li><br>        <li><br>           下线服务A(V1.0)，服务B(V1.0)，灰度成功<br>        </li><br>        <li><br>           灰度网关(V1.1)可以不用下线，留作下次版本上线再次灰度发布<br>        </li><br>    </ul><br>    架构图<br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c2733c95e8887?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="jpeg" class="lazyload inited loaded" data-width="1080" data-height="737" src="https://user-gold-cdn.xitu.io/2018/7/22/164c2733c95e8887?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    兼容<br>    版本兼容情况<br>    <ul><br>        <li><br>           Spring Cloud F版，请采用4.x.x版本，具体代码参考master分支<br>        </li><br>        <li><br>            Spring Cloud C版、D版和E版，请采用3.x.x版本，具体代码参考Edgware分支<br>        </li><br>        <li><br>           4.x.x版本由于Swagger和Spring Boot 2.x.x版本的Actuator用法有冲突，故暂时不支持Endpoint功能，其他功能和3.x.x版本一致<br>        </li><br>    </ul><br>    中间件兼容情况<br>    <ul><br>        <li><br>            Consul<br>        </li><br>        <li><br>            Spring Cloud F版，最好采用Consul的1.2.1服务器版本（或者更高），从<a href="https://releases.hashicorp.com/consul/1.2.1/获取" target="_blank" rel="noopener">https://releases.hashicorp.com/consul/1.2.1/获取</a><br>        </li><br>        <li><br>           Spring Cloud C版、D版和E版，必须采用Consul的0.9.3服务器版本（或者更低），从<a href="https://releases.hashicorp.com/consul/0.9.3/获取" target="_blank" rel="noopener">https://releases.hashicorp.com/consul/0.9.3/获取</a><br>        </li><br>        <li><br>            Zookeeper<br>        </li><br>        <li><br>            Spring Cloud F版，必须采用Zookeeper的3.5.x服务器版本（或者更高）<br>        </li><br>        <li><br>            Spring Cloud C版、D版和E版，最好采用Zookeeper的3.5.0以下服务器版本（或者更低）<br>        </li><br>        <li><br>            Eureka<br>        </li><br>        <li><br>            跟Spring Cloud版本保持一致<br>        </li><br>    </ul><br>    <h2 data-id="heading-6">依赖</h2><br>    微服务选择相应的插件引入，最后一个如需对接Nacos远程配置中心，则引入<br>    <pre><code><ol><li><code>&lt;dependency&gt;</code></li><li><code> &nbsp; &nbsp;&lt;groupId&gt;com.nepxion&lt;/groupId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;artifactId&gt;discovery-plugin-starter-eureka&lt;/artifactId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;version&gt;${discovery.plugin.version}&lt;/version&gt;</code></li><li><code>&lt;/dependency&gt;</code></li><li><code></code></li><li><code>&lt;dependency&gt;</code></li><li><code> &nbsp; &nbsp;&lt;groupId&gt;com.nepxion&lt;/groupId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;artifactId&gt;discovery-plugin-starter-consul&lt;/artifactId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;version&gt;${discovery.plugin.version}&lt;/version&gt;</code></li><li><code>&lt;/dependency&gt;</code></li><li><code></code></li><li><code>&lt;dependency&gt;</code></li><li><code> &nbsp; &nbsp;&lt;groupId&gt;com.nepxion&lt;/groupId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;artifactId&gt;discovery-plugin-starter-zookeeper&lt;/artifactId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;version&gt;${discovery.plugin.version}&lt;/version&gt;</code></li><li><code>&lt;/dependency&gt;</code></li><li><code></code></li><li><code>&lt;dependency&gt;</code></li><li><code> &nbsp; &nbsp;&lt;groupId&gt;com.nepxion&lt;/groupId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;artifactId&gt;discovery-plugin-config-center-extension-nacos&lt;/artifactId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;version&gt;${discovery.plugin.version}&lt;/version&gt;</code></li><li><code>&lt;/dependency&gt;</code></li></ol></code></pre><br>    独立控制台引入，最后一个如需对接Nacos远程配置中心，则引入<br>    <pre><code><ol><li><code>&lt;dependency&gt;</code></li><li><code> &nbsp; &nbsp;&lt;groupId&gt;com.nepxion&lt;/groupId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;artifactId&gt;discovery-console-starter&lt;/artifactId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;version&gt;${discovery.plugin.version}&lt;/version&gt;</code></li><li><code>&lt;/dependency&gt;</code></li><li><code></code></li><li><code>&lt;dependency&gt;</code></li><li><code> &nbsp; &nbsp;&lt;groupId&gt;com.nepxion&lt;/groupId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;artifactId&gt;discovery-console-extension-nacos&lt;/artifactId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;version&gt;${discovery.plugin.version}&lt;/version&gt;</code></li><li><code>&lt;/dependency&gt;</code></li></ol></code></pre><br>    <h2 data-id="heading-7">工程</h2><br>    <table><br>        <thead><br>            <tr><br>                <th>工程名</th><br>                <th>描述</th><br>            </tr><br>        </thead><br>        <tbody><br>            <tr><br>                <td>discovery-plugin-framework</td><br>                <td>核心框架</td><br>            </tr><br>            <tr><br>                <td>discovery-plugin-framework-eureka</td><br>                <td>核心框架的Eureka实现</td><br>            </tr><br>            <tr><br>                <td>discovery-plugin-framework-consul</td><br>                <td>核心框架的Consul实现</td><br>            </tr><br>            <tr><br>                <td>discovery-plugin-framework-zookeeper</td><br>                <td>核心框架的Zookeeper实现</td><br>            </tr><br>            <tr><br>                <td>discovery-plugin-config-center</td><br>                <td>配置中心实现</td><br>            </tr><br>            <tr><br>                <td>discovery-plugin-config-center-extension-nacos</td><br>                <td>配置中心的Nacos扩展</td><br>            </tr><br>            <tr><br>                <td>discovery-plugin-admin-center</td><br>                <td>管理中心实现</td><br>            </tr><br>            <tr><br>                <td>discovery-plugin-starter-eureka</td><br>                <td>Eureka Starter</td><br>            </tr><br>            <tr><br>                <td>discovery-plugin-starter-consul</td><br>                <td>Consul Starter</td><br>            </tr><br>            <tr><br>                <td>discovery-plugin-starter-zookeeper</td><br>                <td>Zookeeper Starter</td><br>            </tr><br>            <tr><br>                <td>discovery-console</td><br>                <td>独立控制台，提供给UI</td><br>            </tr><br>            <tr><br>                <td>discovery-console-extension-nacos</td><br>                <td>独立控制台的Nacos扩展</td><br>            </tr><br>            <tr><br>                <td>discovery-console-starter</td><br>                <td>Console Starter</td><br>            </tr><br>            <tr><br>                <td>discovery-console-desktop</td><br>                <td>图形化灰度发布等桌面程序</td><br>            </tr><br>            <tr><br>                <td>discovery-springcloud-example-console</td><br>                <td>独立控制台示例</td><br>            </tr><br>            <tr><br>                <td>discovery-springcloud-example-eureka</td><br>                <td>Eureka服务器</td><br>            </tr><br>            <tr><br>                <td>discovery-springcloud-example</td><br>                <td>灰度发布等示例</td><br>            </tr><br>        </tbody><br>    </table><br>    <h2 data-id="heading-8">规则和策略</h2><br>    <h3 data-id="heading-9">规则示例</h3><br>    请不要被吓到，我只是把注释写的很详细而已，里面配置没几行<br>    <pre><code><ol><li><code>&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;</code></li><li><code>&lt;rule&gt;</code></li><li><code> &nbsp; &nbsp;&lt;!– 如果不想开启相关功能，只需要把相关节点删除即可，例如不想要黑名单功能，把blacklist节点删除 –&gt;</code></li><li><code> &nbsp; &nbsp;&lt;register&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 服务注册的黑/白名单注册过滤，只在服务启动的时候生效。白名单表示只允许指定IP地址前缀注册，黑名单表示不允许指定IP地址前缀注册。每个服务只能同时开启要么白名单，要么黑名单 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– filter-type，可选值blacklist/whitelist，表示白名单或者黑名单 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– service-name，表示服务名 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– filter-value，表示黑/白名单的IP地址列表。IP地址一般用前缀来表示，如果多个用“;”分隔，不允许出现空格 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示下面所有服务，不允许10.10和11.11为前缀的IP地址注册（全局过滤） –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;blacklist filter-value=”10.10;11.11”&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示下面服务，不允许172.16和10.10和11.11为前缀的IP地址注册 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service service-name=”discovery-springcloud-example-a” filter-value=”172.16”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/blacklist&gt;</code></li><li><code></code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– &lt;whitelist filter-value=””&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service service-name=”” filter-value=””/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/whitelist&gt; &nbsp;–&gt;</code></li><li><code></code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 服务注册的数目限制注册过滤，只在服务启动的时候生效。当某个服务的实例注册达到指定数目时候，更多的实例将无法注册 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– service-name，表示服务名 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– filter-value，表示最大实例注册数 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示下面所有服务，最大实例注册数为10000（全局配置） –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;count filter-value=”10000”&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示下面服务，最大实例注册数为5000，全局配置值10000将不起作用，以局部配置值为准 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service service-name=”discovery-springcloud-example-a” filter-value=”5000”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/count&gt;</code></li><li><code> &nbsp; &nbsp;&lt;/register&gt;</code></li><li><code></code></li><li><code> &nbsp; &nbsp;&lt;discovery&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 服务发现的黑/白名单发现过滤，使用方式跟“服务注册的黑/白名单过滤”一致 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示下面所有服务，不允许10.10和11.11为前缀的IP地址被发现（全局过滤） –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;blacklist filter-value=”10.10;11.11”&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示下面服务，不允许172.16和10.10和11.11为前缀的IP地址被发现 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service service-name=”discovery-springcloud-example-b” filter-value=”172.16”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/blacklist&gt;</code></li><li><code></code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 服务发现的多版本灰度访问控制 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– service-name，表示服务名 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– version-value，表示可供访问的版本，如果多个用“;”分隔，不允许出现空格 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;version&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示消费端服务a的1.0，允许访问提供端服务b的1.0和1.1版本 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service consumer-service-name=”discovery-springcloud-example-a” provider-service-name=”discovery-springcloud-example-b” consumer-version-value=”1.0” provider-version-value=”1.0;1.1”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示消费端服务b的1.0，允许访问提供端服务c的1.0和1.1版本 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service consumer-service-name=”discovery-springcloud-example-b” provider-service-name=”discovery-springcloud-example-c” consumer-version-value=”1.0” provider-version-value=”1.0;1.1”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示消费端服务b的1.1，允许访问提供端服务c的1.2版本 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service consumer-service-name=”discovery-springcloud-example-b” provider-service-name=”discovery-springcloud-example-c” consumer-version-value=”1.1” provider-version-value=”1.2”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/version&gt;</code></li><li><code> &nbsp; &nbsp;&lt;/discovery&gt;</code></li><li><code>&lt;/rule&gt;</code></li></ol></code></pre><br>    <h3 data-id="heading-10">多版本灰度规则策略</h3><br>    <pre><code><ol><li><code>版本策略介绍</code></li><li><code>1. 标准配置，举例如下</code></li><li><code> &nbsp; &lt;service consumer-service-name=”a” provider-service-name=”b” consumer-version-value=”1.0” provider-version-value=”1.0,1.1”/&gt; 表示消费端1.0版本，允许访问提供端1.0和1.1版本</code></li><li><code>2. 版本值不配置，举例如下</code></li><li><code> &nbsp; &lt;service consumer-service-name=”a” provider-service-name=”b” provider-version-value=”1.0,1.1”/&gt; 表示消费端任何版本，允许访问提供端1.0和1.1版本</code></li><li><code> &nbsp; &lt;service consumer-service-name=”a” provider-service-name=”b” consumer-version-value=”1.0”/&gt; 表示消费端1.0版本，允许访问提供端任何版本</code></li><li><code> &nbsp; &lt;service consumer-service-name=”a” provider-service-name=”b”/&gt; 表示消费端任何版本，允许访问提供端任何版本</code></li><li><code>3. 版本值空字符串，举例如下</code></li><li><code> &nbsp; &lt;service consumer-service-name=”a” provider-service-name=”b” consumer-version-value=”” provider-version-value=”1.0,1.1”/&gt; 表示消费端任何版本，允许访问提供端1.0和1.1版本</code></li><li><code> &nbsp; &lt;service consumer-service-name=”a” provider-service-name=”b” consumer-version-value=”1.0” provider-version-value=””/&gt; 表示消费端1.0版本，允许访问提供端任何版本</code></li><li><code> &nbsp; &lt;service consumer-service-name=”a” provider-service-name=”b” consumer-version-value=”” provider-version-value=””/&gt; 表示消费端任何版本，允许访问提供端任何版本</code></li><li><code>4. 版本对应关系未定义，默认消费端任何版本，允许访问提供端任何版本</code></li><li><code></code></li><li><code>特殊情况处理，在使用上需要极力避免该情况发生</code></li><li><code>1. 消费端的application.properties未定义版本号，则该消费端可以访问提供端任何版本</code></li><li><code>2. 提供端的application.properties未定义版本号，当消费端在xml里不做任何版本配置，才可以访问该提供端</code></li></ol></code></pre><br>    <h3 data-id="heading-11">动态改变规则策略</h3><br>    微服务启动的时候，由于规则（例如：rule.xml）已经配置在本地，使用者希望改变一下规则，而不重启微服务，达到规则的改变<br>    <ul><br>        <li><br>            规则分为本地规则和动态规则<br>        </li><br>        <li><br>            本地规则是通过在本地规则（例如：rule.xml）文件定义的，也可以从远程配置中心获取，在微服务启动的时候读取<br>        </li><br>        <li><br>            动态规则是通过POST方式动态设置，或者由远程配置中心推送设置<br>        </li><br>        <li><br>            规则初始化的时候，如果接入了远程配置中心，先读取远程规则，如果不存在，再读取本地规则文件<br>        </li><br>        <li><br>            多规则灰度获取规则的时候，先获取动态规则，如果不存在，再获取本地规则<br>        </li><br>    </ul><br>    <h3 data-id="heading-12">动态改变版本策略</h3><br>    微服务启动的时候，由于版本已经写死在application.properties里，使用者希望改变一下版本，而不重启微服务，达到访问版本的路径改变<br>    <ul><br>        <li><br>            版本分为本地版本和动态版本<br>        </li><br>        <li><br>            本地版本是通过在application.properties里配置的，在微服务启动的时候读取<br>        </li><br>        <li><br>            动态版本是通过POST方式动态设置<br>        </li><br>        <li><br>            多版本灰度获取版本值的时候，先获取动态版本，如果不存在，再获取本地版本<br>        </li><br>    </ul><br>    <h3 data-id="heading-13">黑/白名单的IP地址注册的过滤策略</h3><br>    微服务启动的时候，禁止指定的IP地址注册到服务注册发现中心。支持黑/白名单，白名单表示只允许指定IP地址前缀注册，黑名单表示不允许指定IP地址前缀注册<br>    <ul><br>        <li><br>            全局过滤，指注册到服务注册发现中心的所有微服务，只有IP地址包含在全局过滤字段的前缀中，都允许注册（对于白名单而言），或者不允许注册（对于黑名单而言）<br>        </li><br>        <li><br>            局部过滤，指专门针对某个微服务而言，那么真正的过滤条件是全局过滤+局部过滤结合在一起<br>        </li><br>    </ul><br>    <h3 data-id="heading-14">最大注册数的限制的过滤策略</h3><br>    微服务启动的时候，一旦微服务集群下注册的实例数目已经达到上限（可配置），将禁止后续的微服务进行注册<br>    <ul><br>        <li><br>            全局配置值，只下面配置所有的微服务集群，最多能注册多少个<br>        </li><br>        <li><br>            局部配置值，指专门针对某个微服务而言，那么该值如存在，全局配置值失效<br>        </li><br>    </ul><br>    <h3 data-id="heading-15">黑/白名单的IP地址发现的过滤策略</h3><br>    微服务启动的时候，禁止指定的IP地址被服务发现。它使用的方式和“黑/白名单的IP地址注册的过滤”一致<br>    <h3 data-id="heading-16">版本属性字段定义策略</h3><br>    不同的服务注册发现组件对应的版本配置值<br>    <pre><code><ol><li><code># Eureka config</code></li><li><code>eureka.instance.metadataMap.version=1.0</code></li><li><code>eureka.instance.metadataMap.group=xxx-service-group</code></li><li><code></code></li><li><code># 奇葩的Consul配置（参考<a href="https://springcloud.cc/spring-cloud-consul.html" target="_blank" rel="noopener">https://springcloud.cc/spring-cloud-consul.html</a> - 元数据和Consul标签）</code></li><li><code># Consul config（多个值用“,”分隔，例如version=1.0,value=abc）</code></li><li><code>spring.cloud.consul.discovery.tags=version=1.0,group=xxx-service-group</code></li><li><code></code></li><li><code># Zookeeper config</code></li><li><code>spring.cloud.zookeeper.discovery.metadata.version=1.0</code></li><li><code>spring.cloud.zookeeper.discovery.metadata.group=xxx-service-group</code></li></ol></code></pre><br>    <h3 data-id="heading-17">功能开关策略</h3><br>    <pre><code><ol><li><code># Plugin config</code></li><li><code># 开启和关闭服务注册层面的控制。一旦关闭，服务注册的黑/白名单过滤功能将失效，最大注册数的限制过滤功能将失效。缺失则默认为true</code></li><li><code>spring.application.register.control.enabled=true</code></li><li><code># 开启和关闭服务发现层面的控制。一旦关闭，服务多版本调用的控制功能将失效，动态屏蔽指定IP地址的服务实例被发现的功能将失效。缺失则默认为true</code></li><li><code>spring.application.discovery.control.enabled=true</code></li><li><code># 开启和关闭通过Rest方式对规则配置的控制和推送。一旦关闭，只能通过远程配置中心来控制和推送。缺失则默认为true</code></li><li><code>spring.application.config.rest.control.enabled=true</code></li><li><code># 本地规则文件的路径，支持两种方式：classpath:rule.xml - 规则文件放在resources目录下，便于打包进jar；file:rule.xml - 规则文件放在工程根目录下，放置在外部便于修改。缺失则默认为不装载本地规则</code></li><li><code>spring.application.config.path=classpath:rule.xml</code></li><li><code># 为微服务归类的Key，一般通过group字段来归类，例如eureka.instance.metadataMap.group=xxx-group或者eureka.instance.metadataMap.application=xxx-application。缺失则默认为group</code></li><li><code># spring.application.group.key=group</code></li><li><code># spring.application.group.key=application</code></li></ol></code></pre><br>    <h2 data-id="heading-18">配置中心</h2><br>    <h3 data-id="heading-19">跟远程配置中心整合</h3><br>    本系统默认跟Nacos集成，如何安装使用，请参考<a href="https://github.com/alibaba/nacos。使用者也可以跟携程Apollo，百度DisConf等远程配置中心整合，实现规则读取和订阅" target="_blank" rel="noopener">https://github.com/alibaba/nacos。使用者也可以跟携程Apollo，百度DisConf等远程配置中心整合，实现规则读取和订阅</a><br>    <ul><br>        <li><br>            拉取配置，参考discovery-plugin-config-center-extension-nacos工程<br>        </li><br>        <li><br>            推送配置，参考discovery-console-extension-nacos工程<br>        </li><br>    </ul><br>    <h2 data-id="heading-20">管理中心</h2><br>    <blockquote><br>        PORT端口号为server.port或者management.port都可以（management.port开放只支持3.x.x版本）<br>        <h3 data-id="heading-21">配置接口</h3><br>        <h3 data-id="heading-22">版本接口</h3><br>        <h3 data-id="heading-23">路由接口</h3><br>        参考Swagger界面，如下图<br>    </blockquote><br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c2733cb52283a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="png" class="lazyload inited loaded" data-width="1080" data-height="964" src="https://user-gold-cdn.xitu.io/2018/7/22/164c2733cb52283a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    <h2 data-id="heading-24">独立控制台</h2><br>    为UI提供相关接口，包括<br>    <ul><br>        <li><br>            一系列批量功能<br>        </li><br>        <li><br>            跟Nacos集成，实现配置推送和清除<br>        </li><br>    </ul><br>    <blockquote><br>        PORT端口号为server.port或者management.port都可以（management.port开放只支持3.x.x版本）<br>        <h3 data-id="heading-25">控制台接口</h3><br>        参考Swagger界面，如下图<br>    </blockquote><br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c2733c892375f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="jpeg" class="lazyload inited loaded" data-width="1080" data-height="829" src="https://user-gold-cdn.xitu.io/2018/7/22/164c2733c892375f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    <h2 data-id="heading-26">扩展和自定义更多规则或者监听</h2><br>    使用者可以继承如下类<br>    <ul><br>        <li><br>            AbstractRegisterListener，实现服务注册的扩展和监听<br>        </li><br>        <li><br>            AbstractDiscoveryListener，实现服务发现的扩展和监听，注意，在Consul下，同时会触发service和management两个实例的事件，需要区别判断，如下图<br>        </li><br>    </ul><br>    集成了健康检查的Consul控制台<br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c2733c962de18?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="png" class="lazyload inited loaded" data-width="1080" data-height="387" src="https://user-gold-cdn.xitu.io/2018/7/22/164c2733c962de18?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    <h2 data-id="heading-27">示例演示</h2><br>    <h3 data-id="heading-28">场景描述</h3><br>    本例将模拟一个较为复杂的场景，如下图<br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c2733eb71dd1b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="jpeg" class="lazyload inited loaded" data-width="1080" data-height="917" src="https://user-gold-cdn.xitu.io/2018/7/22/164c2733eb71dd1b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    <ul><br>        <li><br>            系统部署情况：<br>        </li><br>        <li><br>            网关Zuul集群部署了1个<br>        </li><br>        <li><br>            微服务集群部署了3个，分别是A服务集群、B服务集群、C服务集群，分别对应的实例数为2、2、3<br>        </li><br>        <li><br>            微服务集群的调用关系为网关Zuul-&gt;服务A-&gt;服务B-&gt;服务C<br>        </li><br>        <li><br>            系统调用关系<br>        </li><br>        <li><br>            网关Zuul的1.0版本只能调用服务A的1.0版本，网关Zuul的1.1版本只能调用服务A的1.1版本<br>        </li><br>        <li><br>            服务A的1.0版本只能调用服务B的1.0版本，服务A的1.1版本只能调用服务B的1.1版本<br>        </li><br>        <li><br>            服务B的1.0版本只能调用服务C的1.0和1.1版本，服务B的1.1版本只能调用服务C的1.2版本<br>        </li><br>    </ul><br>    用规则来表述上述关系<br>    <pre><code><ol><li><code>&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;</code></li><li><code>&lt;rule&gt;</code></li><li><code> &nbsp; &nbsp;&lt;discovery&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;version&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示网关z的1.0，允许访问提供端服务a的1.0版本 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service consumer-service-name=”discovery-springcloud-example-zuul” provider-service-name=”discovery-springcloud-example-a” consumer-version-value=”1.0” provider-version-value=”1.0”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示网关z的1.1，允许访问提供端服务a的1.1版本 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service consumer-service-name=”discovery-springcloud-example-zuul” provider-service-name=”discovery-springcloud-example-a” consumer-version-value=”1.1” provider-version-value=”1.1”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示消费端服务a的1.0，允许访问提供端服务b的1.0版本 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service consumer-service-name=”discovery-springcloud-example-a” provider-service-name=”discovery-springcloud-example-b” consumer-version-value=”1.0” provider-version-value=”1.0”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示消费端服务a的1.1，允许访问提供端服务b的1.1版本 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service consumer-service-name=”discovery-springcloud-example-a” provider-service-name=”discovery-springcloud-example-b” consumer-version-value=”1.1” provider-version-value=”1.1”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示消费端服务b的1.0，允许访问提供端服务c的1.0和1.1版本 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service consumer-service-name=”discovery-springcloud-example-b” provider-service-name=”discovery-springcloud-example-c” consumer-version-value=”1.0” provider-version-value=”1.0;1.1”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!– 表示消费端服务b的1.1，允许访问提供端服务c的1.2版本 –&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service consumer-service-name=”discovery-springcloud-example-b” provider-service-name=”discovery-springcloud-example-c” consumer-version-value=”1.1” provider-version-value=”1.2”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/version&gt;</code></li><li><code> &nbsp; &nbsp;&lt;/discovery&gt;</code></li><li><code>&lt;/rule&gt;</code></li></ol></code></pre><br>    上述微服务分别见discovery-springcloud-example字样的8个DiscoveryApplication，分别对应各自的application.properties。这8个应用，对应的版本和端口号如下表<br>    <table><br>        <thead><br>            <tr><br>                <th>微服务</th><br>                <th>服务端口</th><br>                <th>管理端口</th><br>                <th>版本</th><br>            </tr><br>        </thead><br>        <tbody><br>            <tr><br>                <td>A1</td><br>                <td>1100</td><br>                <td>5100</td><br>                <td>1.0</td><br>            </tr><br>            <tr><br>                <td>A2</td><br>                <td>1101</td><br>                <td>5101</td><br>                <td>1.1</td><br>            </tr><br>            <tr><br>                <td>B1</td><br>                <td>1200</td><br>                <td>5200</td><br>                <td>1.0</td><br>            </tr><br>            <tr><br>                <td>B2</td><br>                <td>1201</td><br>                <td>5201</td><br>                <td>1.1</td><br>            </tr><br>            <tr><br>                <td>C1</td><br>                <td>1300</td><br>                <td>5300</td><br>                <td>1.0</td><br>            </tr><br>            <tr><br>                <td>C2</td><br>                <td>1301</td><br>                <td>5301</td><br>                <td>1.1</td><br>            </tr><br>            <tr><br>                <td>C3</td><br>                <td>1302</td><br>                <td>5302</td><br>                <td>1.2</td><br>            </tr><br>            <tr><br>                <td>Zuul</td><br>                <td>1400</td><br>                <td>5400</td><br>                <td>1.0</td><br>            </tr><br>        </tbody><br>    </table><br>    独立控制台见discovery-springcloud-example-console，对应的版本和端口号如下表<br>    <table><br>        <thead><br>            <tr><br>                <th>服务端口</th><br>                <th>管理端口</th><br>            </tr><br>        </thead><br>        <tbody><br>            <tr><br>                <td>2222</td><br>                <td>3333</td><br>            </tr><br>        </tbody><br>    </table><br>    <h3 data-id="heading-29">开始演示</h3><br>    <ul><br>        <li><br>            启动服务注册发现中心，默认是Eureka。可供选择的有Eureka，Zuul，Zookeeper。Eureka，请启动discovery-springcloud-example-eureka下的应用，后两者自行安装服务器<br>        </li><br>        <li><br>            根据上面选择的服务注册发现中心，对示例下的discovery-springcloud-example/pom.xml进行组件切换<br>        </li><br>    </ul><br>    <pre><code><ol><li><code>&lt;dependency&gt;</code></li><li><code> &nbsp; &nbsp;&lt;groupId&gt;com.nepxion&lt;/groupId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;artifactId&gt;discovery-plugin-starter-eureka&lt;/artifactId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;!– &lt;artifactId&gt;discovery-plugin-starter-consul&lt;/artifactId&gt; –&gt;</code></li><li><code> &nbsp; &nbsp;&lt;!– &lt;artifactId&gt;discovery-plugin-starter-zookeeper&lt;/artifactId&gt; –&gt;</code></li><li><code> &nbsp; &nbsp;&lt;version&gt;${discovery.plugin.version}&lt;/version&gt;</code></li><li><code>&lt;/dependency&gt;</code></li></ol></code></pre><br>    <ul><br>        <li><br>            根据上面选择的服务注册发现中心，对控制台下的discovery-springcloud-example-console/pom.xml进行组件切换切换<br>        </li><br>    </ul><br>    <pre><code><ol><li><code>&lt;dependency&gt;</code></li><li><code> &nbsp; &nbsp;&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</code></li><li><code> &nbsp; &nbsp;&lt;!– &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; –&gt;</code></li><li><code> &nbsp; &nbsp;&lt;!– &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt; –&gt;</code></li><li><code>&lt;/dependency&gt;</code></li></ol></code></pre><br>    <h3 data-id="heading-30">服务注册过滤的操作演示</h3><br>    黑/白名单的IP地址注册的过滤<br>    <ul><br>        <li><br>            在rule.xml把本地IP地址写入到相应地方<br>        </li><br>        <li><br>            启动DiscoveryApplicationA1.java<br>        </li><br>        <li><br>            抛出禁止注册的异常，即本地服务受限于黑名单的IP地址列表，不会注册到服务注册发现中心；白名单操作也是如此，不过逻辑刚好相反<br>        </li><br>    </ul><br>    最大注册数的限制的过滤<br>    <ul><br>        <li><br>            在rule.xml修改最大注册数为0<br>        </li><br>        <li><br>            启动DiscoveryApplicationA1.java<br>        </li><br>        <li><br>            抛出禁止注册的异常，即本地服务受限于最大注册数，不会注册到服务注册发现中心<br>        </li><br>    </ul><br>    黑/白名单的IP地址发现的过滤<br>    <ul><br>        <li><br>            在rule.xml把本地IP地址写入到相应地方<br>        </li><br>        <li><br>            启动DiscoveryApplicationA1.java和DiscoveryApplicationB1.java、DiscoveryApplicationB2.java<br>        </li><br>        <li><br>            你会发现A服务无法获取B服务的任何实例，即B服务受限于黑名单的IP地址列表，不会被A服务的发现；白名单操作也是如此，不过逻辑刚好相反<br>        </li><br>    </ul><br>    <h3 data-id="heading-31">服务发现和负载均衡控制的操作演示</h3><br>    <h4 data-id="heading-32">基于图形化方式的多版本灰度访问控制</h4><br>    <ul><br>        <li><br>            请访问<a href="http://www.iqiyi.com/w_19s07thtsh.html，视频清晰度改成720P，然后最大化播放" target="_blank" rel="noopener">http://www.iqiyi.com/w_19s07thtsh.html，视频清晰度改成720P，然后最大化播放</a><br>        </li><br>        <li><br>            请访问<a href="https://pan.baidu.com/s/1eq_N56VbgSCaTXYQ5aKqiA，获取更清晰的视频" target="_blank" rel="noopener">https://pan.baidu.com/s/1eq_N56VbgSCaTXYQ5aKqiA，获取更清晰的视频</a><br>        </li><br>    </ul><br><br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c2733f4a84432?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="png" class="lazyload inited loaded" data-width="1080" data-height="496" src="https://user-gold-cdn.xitu.io/2018/7/22/164c2733f4a84432?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c27341aa44d0e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="png" class="lazyload inited loaded" data-width="1080" data-height="763" src="https://user-gold-cdn.xitu.io/2018/7/22/164c27341aa44d0e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br><br>    基于Rest方式的多版本灰度访问控制<br>    基于服务的操作过程和效果<br>    <ul><br>        <li><br>            启动discovery-springcloud-example下7个DiscoveryApplication（除去Zuul），无先后顺序，等待全部启动完毕<br>        </li><br>        <li><br>            下面URL的端口号，可以是服务端口号，也可以是管理端口号<br>        </li><br>        <li><br>            通过版本切换，达到灰度访问控制，针对A服务<br>        </li><br>        <li><br>            1.1 通过Postman或者浏览器，执行POST&nbsp;<a href="http://localhost:1100/routes，填入discovery-springcloud-example-b;discovery-springcloud-example-c，查看路由路径，如图1，可以看到符合预期的调用路径" target="_blank" rel="noopener">http://localhost:1100/routes，填入discovery-springcloud-example-b;discovery-springcloud-example-c，查看路由路径，如图1，可以看到符合预期的调用路径</a><br>        </li><br>        <li><br>            1.2 通过Postman或者浏览器，执行POST&nbsp;<a href="http://localhost:1100/version/update，填入1.1，动态把服务A的版本从1.0切换到1.1" target="_blank" rel="noopener">http://localhost:1100/version/update，填入1.1，动态把服务A的版本从1.0切换到1.1</a><br>        </li><br>        <li><br>            1.3 通过Postman或者浏览器，再执行第一步操作，如图2，可以看到符合预期的调用路径，通过版本切换，灰度访问控制成功<br>        </li><br>        <li><br>            通过规则改变，达到灰度访问控制，针对B服务<br>        </li><br>        <li><br>            2.1 通过Postman或者浏览器，执行POST&nbsp;<a href="http://localhost:1200/config/update-sync，发送新的规则XML（内容见下面）" target="_blank" rel="noopener">http://localhost:1200/config/update-sync，发送新的规则XML（内容见下面）</a><br>        </li><br>        <li><br>            2.2 通过Postman或者浏览器，执行POST&nbsp;<a href="http://localhost:1201/config/update-sync，发送新的规则XML（内容见下面）" target="_blank" rel="noopener">http://localhost:1201/config/update-sync，发送新的规则XML（内容见下面）</a><br>        </li><br>        <li><br>            2.3 上述操作也可以通过独立控制台，进行批量更新，见图5。操作的逻辑：B服务的所有版本都只能访问C服务3.0版本，而本例中C服务3.0版本是不存在的，意味着这么做B服务不能访问C服务<br>        </li><br>        <li><br>            2.4 重复1.1步骤，发现调用路径只有A服务-&gt;B服务，如图3，通过规则改变，灰度访问控制成功<br>        </li><br>        <li><br>            负载均衡的灰度测试<br>        </li><br>        <li><br>            3.1 通过Postman或者浏览器，执行POST&nbsp;<a href="http://localhost:1100/invoke，这是example内置的访问路径示例（通过Feign实现）" target="_blank" rel="noopener">http://localhost:1100/invoke，这是example内置的访问路径示例（通过Feign实现）</a><br>        </li><br>        <li><br>            3.2 重复“通过版本切换，达到灰度访问控制”或者“通过规则改变，达到灰度访问控制”操作，查看Ribbon负载均衡的灰度结果，如图4<br>        </li><br>        <li><br>            上述操作，都是单次操作，如需要批量操作，可通过“独立控制台”接口，它集成批量操作和推送到远程配置中心的功能，可以取代上面的某些调用方式<br>        </li><br>        <li><br>            其它更多操作，请参考“配置中心”、“管理中心”和“独立控制台”<br>        </li><br>    </ul><br>    新XML规则<br>    <pre><code><ol><li><code>&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;</code></li><li><code>&lt;rule&gt;</code></li><li><code> &nbsp; &nbsp;&lt;discovery&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;version&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;service consumer-service-name=”discovery-springcloud-example-b” provider-service-name=”discovery-springcloud-example-c” consumer-version-value=”” provider-version-value=”3.0”/&gt;</code></li><li><code> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/version&gt;</code></li><li><code> &nbsp; &nbsp;&lt;/discovery&gt;</code></li><li><code>&lt;/rule&gt;</code></li></ol></code></pre><br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c273461578b55?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="png" class="lazyload inited loaded" data-width="654" data-height="612" src="https://user-gold-cdn.xitu.io/2018/7/22/164c273461578b55?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c27347067221a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="png" class="lazyload inited loaded" data-width="668" data-height="500" src="https://user-gold-cdn.xitu.io/2018/7/22/164c27347067221a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c2734732d985b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="png" class="lazyload inited loaded" data-width="574" data-height="354" src="https://user-gold-cdn.xitu.io/2018/7/22/164c2734732d985b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c27347658b7e1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="png" class="lazyload inited loaded" data-width="1080" data-height="699" src="https://user-gold-cdn.xitu.io/2018/7/22/164c27347658b7e1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c27347a81d43d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="png" class="lazyload inited loaded" data-width="1080" data-height="654" src="https://user-gold-cdn.xitu.io/2018/7/22/164c27347a81d43d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c27347a81d43d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="png" class="lazyload inited loaded" data-width="1080" data-height="654" src="https://user-gold-cdn.xitu.io/2018/7/22/164c27347a81d43d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    基于网关的操作过程和效果<br>    <ul><br>        <li><br>            在上面基础上，启动discovery-springcloud-example下DiscoveryApplicationZuul<br>        </li><br>        <li><br>            因为Zuul是一种特殊的微服务，所有操作过程跟上面完全一致<br>        </li><br>    </ul><br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c2734898bf386?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="png" class="lazyload inited loaded" data-width="750" data-height="761" src="https://user-gold-cdn.xitu.io/2018/7/22/164c2734898bf386?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    <img data-src="https://user-gold-cdn.xitu.io/2018/7/22/164c273494b31e95?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-type="png" class="lazyload inited loaded" data-width="1080" data-height="722" src="https://user-gold-cdn.xitu.io/2018/7/22/164c273494b31e95?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><br>    项目地址：<a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener">https://github.com/Nepxion/Discovery</a>&nbsp;<br>  </div></article>

<p>  转自：<a href="https://juejin.im/entry/5b54985b518825597f6b7475" target="_blank" rel="noopener">https://juejin.im/entry/5b54985b518825597f6b7475</a></p>

      
    </div>

    
      


    

    
    
    
    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-heart"></i>感谢阅读-------------</div>
    
</div>
      
    </div>
    <div>
      
        

      
    </div>
    

    
      
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>我们都像孩子一样忠实的为自己的想法而活着！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="Codewey WeChat Pay">
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="Codewey Alipay">
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/java/" rel="tag"><i class="fa fa-tag"></i> java</a>
          
            <a href="/tags/SpringCloud/" rel="tag"><i class="fa fa-tag"></i> SpringCloud</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/post/spring-cloud-enableDiscoveryClient-and-enableEurekaClient/" rel="next" title="EnableDiscoveryClient与EnableEurekaClient的区别(Edgware版本)">
                <i class="fa fa-chevron-left"></i> EnableDiscoveryClient与EnableEurekaClient的区别(Edgware版本)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/post/laptop-keyboard-disable-enable/" rel="prev" title="用了五年的笔记本键盘坏掉了">
                用了五年的笔记本键盘坏掉了 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/d6.gif" alt="Codewey">
            
              <p class="site-author-name" itemprop="name">Codewey</p>
              <p class="site-description motion-element" itemprop="description">We are all living as faithful to our ideas as children.</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">34</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">29</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://weibo.com/y759962464" title="Weibo &rarr; https://weibo.com/y759962464" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://instagram.com/dewey_liu" title="Instagram &rarr; https://instagram.com/dewey_liu" rel="noopener" target="_blank"><i class="fa fa-fw fa-instagram"></i></a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.</span> <span class="nav-text">Quick Start</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">2.</span> <span class="nav-text">痛点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">3.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">4.</span> <span class="nav-text">名词解释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">5.</span> <span class="nav-text">场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">6.</span> <span class="nav-text">架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">7.</span> <span class="nav-text">依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">8.</span> <span class="nav-text">工程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">9.</span> <span class="nav-text">规则和策略</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">9.1.</span> <span class="nav-text">规则示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">9.2.</span> <span class="nav-text">多版本灰度规则策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">9.3.</span> <span class="nav-text">动态改变规则策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">9.4.</span> <span class="nav-text">动态改变版本策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">9.5.</span> <span class="nav-text">黑/白名单的IP地址注册的过滤策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">9.6.</span> <span class="nav-text">最大注册数的限制的过滤策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">9.7.</span> <span class="nav-text">黑/白名单的IP地址发现的过滤策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">9.8.</span> <span class="nav-text">版本属性字段定义策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">9.9.</span> <span class="nav-text">功能开关策略</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">10.</span> <span class="nav-text">配置中心</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">10.1.</span> <span class="nav-text">跟远程配置中心整合</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">11.</span> <span class="nav-text">管理中心</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">11.1.</span> <span class="nav-text">配置接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">11.2.</span> <span class="nav-text">版本接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">11.3.</span> <span class="nav-text">路由接口</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">12.</span> <span class="nav-text">独立控制台</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">12.1.</span> <span class="nav-text">控制台接口</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">13.</span> <span class="nav-text">扩展和自定义更多规则或者监听</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">14.</span> <span class="nav-text">示例演示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">14.1.</span> <span class="nav-text">场景描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">14.2.</span> <span class="nav-text">开始演示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">14.3.</span> <span class="nav-text">服务注册过滤的操作演示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">14.4.</span> <span class="nav-text">服务发现和负载均衡控制的操作演示</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">14.4.1.</span> <span class="nav-text">基于图形化方式的多版本灰度访问控制</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Codewey</span>

  

  
</div>

<!--
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a></div>
-->



        








        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


<!---->




  






  















  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="//cdn.jsdelivr.net/npm/jquery-lazyload@1.9.7/jquery.lazyload.min.js"></script>
  

  
  
    <script src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>
  

  
  
    <script src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>
  

  
  
    <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.4.1/dist/jquery.fancybox.min.js"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.6.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  
  <script src="/js/src/scrollspy.js?v=6.6.0"></script>
<script src="/js/src/post-details.js?v=6.6.0"></script>
<script src="/js/src/photoswipe.min.js?v="></script>
<script src="/js/src/photoswipe-ui-default.min.js?v="></script>



  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>

  <script>
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: 'MJFl34UId7bERw6zMfY64eBv-MdYXbMMI',
        appKey: 'SBcM2bkz8gFfwQyp0fnjN7wV',
        placeholder: 'Just go go',
        avatar:'retro',
        meta:guest,
        pageSize:'10' || 10,
        visitor: true
    });
  </script>




  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=6.6.0"></script>



  

  

  

  

  

  
  

  

  
  <script src="/js/src/js.cookie.js?v=6.6.0"></script>
  <script src="/js/src/scroll-cookie.js?v=6.6.0"></script>


  

  

  

  

  <!-- <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script> -->
  <script type="text/javascript" src="/js/src/click.js"></script>
  <div class="waifu">
        <div class="waifu-tips"></div>
        <canvas id="live2d" class="live2d"></canvas>
        <div class="waifu-tool">
            <span class="fui-home"></span>
            <span class="fui-chat"></span>
            <span class="fui-eye"></span>
            <span class="fui-user"></span>
            <span class="fui-photo"></span>
            <span class="fui-info-circle"></span>
            <span class="fui-cross"></span>
        </div>
    </div>
    
<script src="/js/src/live2d/assets/waifu-tips.min.js"></script>
<script src="/js/src/live2d/assets/live2d.min.js"></script>

<script type="text/javascript">
   // live2d_settings['hitokotoAPI'] = 'hitokoto.cn';
    live2d_settings['modelId'] = 1;
    live2d_settings['modelTexturesId'] = 53;
    live2d_settings['modelStorage'] = false;
    live2d_settings['canCloseLive2d'] = true;
    live2d_settings['canTurnToHomePage'] = false;
   // live2d_settings['waifuSize'] = '600x535';
    live2d_settings['waifuTipsSize'] = '280x80';
    live2d_settings['waifuFontSize'] = '12px';
    live2d_settings['waifuToolFont'] = '16px';
    live2d_settings['waifuToolLine'] = '25px';
    live2d_settings['waifuToolTop'] = '0px';
    live2d_settings['waifuDraggable'] = 'axis-x';
    live2d_settings['waifuEdgeSide']  = "right:30";
    initModel("/js/src/live2d/assets/waifu-tips.json")
</script>

<script>!function(o){var i=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function c(t,e){var n=new Image,o=t.getAttribute("data-original");n.onload=function(){t.src=o,e&&e()},n.src=o}function n(){for(var t=0;t<i.length;t++)e=i[t],void 0,0<=(n=e.getBoundingClientRect()).top&&0<=n.left&&n.top<=(o.innerHeight||document.documentElement.clientHeight)&&c(i[t],function(){i.splice(t,t)});var e,n;console.log("trigger")}n(),o.addEventListener("scroll",function(){var t,e;t=n,e=o,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>
</html>
